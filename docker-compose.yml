services:
  # Base Configuration
  base_app: &base_app
    build: .
    extra_hosts:
      - "host.docker.internal:host-gateway"
    tty: true
    env_file:
      - .env
    volumes:
      - ./results:/app/results
      - ./data:/app/data

  # Main App (Run with: docker compose up app)
  app:
    <<: *base_app
    command: ["python", "-m", "src.scalable_sys.app", "--prompt", "Which scholars won Chemistry in 2010?"]

  # Full Validation Pipeline (Run with: docker compose up eval)
  eval:
    <<: *base_app
    command: ["python", "-m", "src.scalable_sys.evaluation.evaluate_pipeline", "--complete-test"]

  # Judge Only (Run with: docker compose up judge)
  judge:
    <<: *base_app
    command: >
      python -m src.scalable_sys.evaluation.evaluate_pipeline 
      --judge-only 
      --plain-file ${PLAIN_FILE} 
      --rag-file ${RAG_FILE}
